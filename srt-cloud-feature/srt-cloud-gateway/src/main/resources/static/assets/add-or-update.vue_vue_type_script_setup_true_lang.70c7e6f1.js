import{d as Z,K as ee,h as i,X as y,a5 as ue,r as s,o as b,c as P,b as e,w as l,a as te,l as p,t as le,a6 as ae,a7 as oe,k as se,af as re,f as A,F as k,e as ne,G as B,E as C}from"./index.afa5927e.js";import{c as de}from"./database.e836db09.js";import{g as ie,u as pe,c as me}from"./apiConfig.3f64c346.js";import{_ as fe}from"./databases.vue_vue_type_style_index_0_lang.b926b0e1.js";import{_ as be}from"./middledb.vue_vue_type_style_index_0_lang.9db5fc2b.js";import _e from"./sql-studio.aa85e1b4.js";import{_ as h}from"./param-studio.vue_vue_type_script_setup_true_lang.44bb4522.js";const Fe=p("\u6570\u636E\u5E93"),Ee=p("\u4E2D\u53F0\u5E93"),ce=p("\u5E93\u8868\u4FE1\u606F"),ge=p("sql\u5206\u5272\u7B26:"),De=p("\u5F00\u653E"),qe=p("\u79C1\u6709"),Ae=p("\u53D6\u6D88"),ve=p("\u63D0\u4EA4"),Pe=Z({__name:"add-or-update",emits:["refreshDataList"],setup(Ve,{expose:I,emit:U}){ee(()=>{j(),M()});const j=()=>{de().then(n=>{u.databaseList=n.data})},v=i(!1),L=()=>{v.value=!0},_=i(!1),w=i(""),M=()=>{ie().then(n=>{w.value=n.data})},f=y({}),F=i(),r=y({name:"",path:"",type:"",note:"",status:0}),$=i({name:[{required:!0,message:"\u5FC5\u586B\u9879\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],path:[{required:!0,message:"\u5FC5\u586B\u9879\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],type:[{required:!0,message:"\u5FC5\u586B\u9879\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),E=i(),u=y({sqlDbType:"",sqlParam:"",sqlText:"\\n",contentType:"application/json",openTrans:0,jsonParam:"{}",responseResult:"{}",sqlSeparator:";\\n",sqlMaxRow:100,databaseId:"",databaseList:[],previlege:""}),N=i({sqlSeparator:[{required:!0,message:"\u5FC5\u586B\u9879\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],sqlMaxRow:[{required:!0,message:"\u5FC5\u586B\u9879\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],contentType:[{required:!0,message:"\u5FC5\u586B\u9879\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],sqlDbType:[{required:!0,message:"\u5FC5\u586B\u9879\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],databaseId:[{required:!0,message:"\u5FC5\u586B\u9879\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],sqlText:[{required:!0,message:"\u5FC5\u586B\u9879\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],jsonParam:[{required:!0,message:"\u5FC5\u586B\u9879\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],responseResult:[{required:!0,message:"\u5FC5\u586B\u9879\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],previlege:[{required:!0,message:"\u5FC5\u586B\u9879\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]});ue("apiSqlForm",u);const m=i(),O=(n,t)=>{_.value=!0,f.id="",f.groupId=t,F.value&&F.value.resetFields(),E.value&&(E.value.resetFields(),m.value.setSqlParam(""),m.value.setEditorValue(""),m.value.closeDebug(),c.value.setEditorValue("{}"),g.value.setEditorValue('{"code":0,"msg":"success","data":[]}')),n&&Q(n)},Q=n=>{pe(n).then(t=>{const o=t.data;Object.assign(f,o),r.name=o.name,r.path=o.path,r.type=o.type,r.note=o.note,r.status=o.status,u.sqlDbType=o.sqlDbType,u.sqlParam=o.sqlParam,u.sqlText=o.sqlText,u.contentType=o.contentType,u.openTrans=o.openTrans,u.jsonParam=o.jsonParam,u.responseResult=o.responseResult,u.sqlSeparator=o.sqlSeparator,u.sqlMaxRow=o.sqlMaxRow,u.databaseId=o.databaseId,u.previlege=o.previlege,m.value.setSqlParam(u.sqlParam),m.value.setEditorValue(u.sqlText),c.value.setEditorValue(u.jsonParam),g.value.setEditorValue(u.responseResult)})},c=i(),g=i(),z=async()=>{let n=!0;await F.value.validate(t=>{if(!t)return C.warning("\u8BF7\u628A\u57FA\u672C\u4FE1\u606F\u7684\u5FC5\u586B\u9879\u8865\u5145\u5B8C\u6574\uFF01"),n=!1,!1}),n&&(u.sqlParam=m.value.getSqlParam(),u.sqlText=m.value.getEditorValue(),u.jsonParam=c.value.getEditorValue(),u.responseResult=g.value.getEditorValue(),await E.value.validate(t=>{if(!t)return C.warning("\u8BF7\u628A API SQL \u914D\u7F6E\u7684\u5FC5\u586B\u9879\u8865\u5145\u5B8C\u6574\uFF01"),n=!1,!1}),n&&(Object.assign(f,r),Object.assign(f,u),await me(f),C.success({message:"\u64CD\u4F5C\u6210\u529F",duration:500,onClose:()=>{_.value=!1,U("refreshDataList")}})))};return I({init:O}),(n,t)=>{const o=s("el-input"),d=s("el-form-item"),T=s("fast-select"),R=s("el-form"),x=s("el-tab-pane"),D=s("el-radio"),S=s("el-radio-group"),V=s("el-button"),G=s("el-option"),H=s("el-select"),q=s("el-tooltip"),K=s("el-switch"),X=s("el-input-number"),J=s("el-tabs"),W=s("el-drawer"),Y=s("el-dialog");return b(),P(k,null,[e(W,{modelValue:_.value,"onUpdate:modelValue":t[14]||(t[14]=a=>_.value=a),title:f.id?"\u4FEE\u6539":"\u65B0\u589E",size:"100%","destroy-on-close":!0},{footer:l(()=>[e(V,{onClick:t[12]||(t[12]=a=>_.value=!1)},{default:l(()=>[Ae]),_:1}),e(V,{type:"primary",onClick:t[13]||(t[13]=a=>z())},{default:l(()=>[ve]),_:1})]),default:l(()=>[te("div",null,[e(J,{"tab-position":"top"},{default:l(()=>[e(x,{label:"\u57FA\u672C\u4FE1\u606F"},{default:l(()=>[e(R,{ref_key:"basicDataFormRef",ref:F,rules:$.value,model:r},{default:l(()=>[e(d,{label:"\u540D\u79F0",prop:"name","label-width":"auto"},{default:l(()=>[e(o,{modelValue:r.name,"onUpdate:modelValue":t[0]||(t[0]=a=>r.name=a),placeholder:"\u540D\u79F0"},null,8,["modelValue"])]),_:1}),e(d,{label:"api\u8DEF\u5F84",prop:"path","label-width":"auto"},{default:l(()=>[e(o,{modelValue:r.path,"onUpdate:modelValue":t[1]||(t[1]=a=>r.path=a),placeholder:"api\u8DEF\u5F84"},{prepend:l(()=>[p(le(w.value),1)]),_:1},8,["modelValue"])]),_:1}),e(d,{label:"\u8BF7\u6C42\u65B9\u5F0F",prop:"type","label-width":"auto"},{default:l(()=>[e(T,{modelValue:r.type,"onUpdate:modelValue":t[2]||(t[2]=a=>r.type=a),"dict-type":"api_type",placeholder:"\u8BF7\u9009\u62E9",clearable:"",filterable:""},null,8,["modelValue"])]),_:1}),e(d,{label:"\u63CF\u8FF0",prop:"note","label-width":"auto"},{default:l(()=>[e(o,{modelValue:r.note,"onUpdate:modelValue":t[3]||(t[3]=a=>r.note=a),rows:2,type:"textarea",placeholder:"\u63CF\u8FF0"},null,8,["modelValue"])]),_:1})]),_:1},8,["rules","model"])]),_:1}),e(x,{label:"API SQL \u914D\u7F6E"},{default:l(()=>[e(R,{ref_key:"apiSqlFormRef",ref:E,rules:N.value,model:u},{default:l(()=>[e(d,{label:"\u9009\u62E9",prop:"sqlDbType","label-width":"auto"},{default:l(()=>[e(S,{modelValue:u.sqlDbType,"onUpdate:modelValue":t[4]||(t[4]=a=>u.sqlDbType=a)},{default:l(()=>[e(D,{label:1,border:""},{default:l(()=>[Fe]),_:1}),e(D,{label:2,border:""},{default:l(()=>[Ee]),_:1})]),_:1},8,["modelValue"]),ae(e(V,{style:{"margin-left":"20px"},icon:se(re),type:"primary",onClick:t[5]||(t[5]=a=>L())},{default:l(()=>[ce]),_:1},8,["icon"]),[[oe,!!u.sqlDbType]])]),_:1}),u.sqlDbType=="1"?(b(),A(d,{key:0,label:"\u9009\u62E9",prop:"databaseId","label-width":"auto"},{default:l(()=>[e(H,{modelValue:u.databaseId,"onUpdate:modelValue":t[6]||(t[6]=a=>u.databaseId=a),clearable:"",filterable:"",placeholder:"\u8BF7\u9009\u62E9"},{default:l(()=>[(b(!0),P(k,null,ne(u.databaseList,(a,ye)=>(b(),A(G,{key:a.id,label:`[${a.id}]${a.name}`,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):B("",!0),e(d,{label:"sql\u5206\u9694\u7B26",prop:"sqlSeparator","label-width":"auto"},{default:l(()=>[e(q,{class:"box-item",effect:"dark",content:"sql \u8BED\u53E5\u5C06\u6309\u7167\u586B\u5199\u7684 sql \u5206\u5272\u7B26\u8FDB\u884C\u5206\u5272",placement:"top-end"},{default:l(()=>[e(o,{modelValue:u.sqlSeparator,"onUpdate:modelValue":t[7]||(t[7]=a=>u.sqlSeparator=a)},{prepend:l(()=>[ge]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(d,{label:"\u5F00\u542F\u4E8B\u52A1","label-width":"auto",prop:"openTrans"},{default:l(()=>[e(q,{effect:"dark",content:"\u5982\u679C\u6570\u636E\u5E93\u672C\u8EAB\u4E0D\u652F\u6301\u4E8B\u52A1, \u5219\u4E0D\u8981\u5F00\u542F",placement:"top-end"},{default:l(()=>[e(K,{modelValue:u.openTrans,"onUpdate:modelValue":t[8]||(t[8]=a=>u.openTrans=a),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1})]),_:1}),e(d,{label:"\u67E5\u8BE2\u6700\u5927\u884C\u6570","label-width":"auto",prop:"sqlMaxRow"},{default:l(()=>[e(q,{effect:"dark",content:"select\u8BED\u53E5\u67E5\u8BE2\u8FD4\u56DE\u7684\u6700\u5927\u884C\u6570",placement:"top-end"},{default:l(()=>[e(X,{modelValue:u.sqlMaxRow,"onUpdate:modelValue":t[9]||(t[9]=a=>u.sqlMaxRow=a),min:1,max:1e3},null,8,["modelValue"])]),_:1})]),_:1}),e(d,{label:"sql\u8BED\u53E5","label-width":"auto",prop:"sqlText"},{default:l(()=>[e(_e,{ref_key:"sqlStudioRef",ref:m,style:{width:"100%"}},null,512)]),_:1}),e(d,{label:"Content-Type",prop:"contentType","label-width":"auto"},{default:l(()=>[e(T,{modelValue:u.contentType,"onUpdate:modelValue":t[10]||(t[10]=a=>u.contentType=a),"dict-type":"content_type"},null,8,["modelValue"])]),_:1}),e(d,{label:"\u8BF7\u6C42\u53C2\u6570\u793A\u4F8B","label-width":"auto",prop:"jsonParam"},{default:l(()=>[e(h,{id:"requestParamStudio",ref_key:"requestParamRef",ref:c,style:{height:"160px",width:"100%"}},null,512)]),_:1}),e(d,{label:"\u54CD\u5E94\u7ED3\u679C\u793A\u4F8B","label-width":"auto",prop:"responseResult"},{default:l(()=>[e(h,{id:"responseResultStudio",ref_key:"responseResultRef",ref:g,style:{height:"160px",width:"100%"}},null,512)]),_:1}),e(d,{label:"\u6743\u9650",prop:"previlege","label-width":"auto"},{default:l(()=>[e(q,{class:"box-item",effect:"dark",content:"\u5F00\u653E\u63A5\u53E3\u53EF\u4EE5\u76F4\u63A5\u8BBF\u95EE, \u79C1\u6709\u63A5\u53E3\u9700\u8981\u5728\u8BF7\u6C42\u5934\u643A\u5E26 token \u8BBF\u95EE, \u8BF7\u524D\u5F80 API \u6743\u9650\u83DC\u5355\u67E5\u770B",placement:"top-end"},{default:l(()=>[e(S,{modelValue:u.previlege,"onUpdate:modelValue":t[11]||(t[11]=a=>u.previlege=a)},{default:l(()=>[e(D,{label:0,border:""},{default:l(()=>[De]),_:1}),e(D,{label:1,border:""},{default:l(()=>[qe]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["rules","model"])]),_:1})]),_:1})])]),_:1},8,["modelValue","title"]),e(Y,{modelValue:v.value,"onUpdate:modelValue":t[15]||(t[15]=a=>v.value=a),title:"\u5E93\u8868\u4FE1\u606F"},{default:l(()=>[u.sqlDbType==1?(b(),A(fe,{key:0,ref:"databasesRef"},null,512)):B("",!0),u.sqlDbType==2?(b(),A(be,{key:1,ref:"middledbRef"},null,512)):B("",!0)]),_:1},8,["modelValue"])],64)}}});export{Pe as _};
