import{d as x,h as f,aa as c,X as I,r as d,o as g,f as _,w as u,b as l,G as C,a1 as w,l as A,al as E,E as P}from"./index.afa5927e.js";import{u as k,a as R}from"./catalogue.705df5b1.js";const $=A("\u53D6\u6D88"),j=A("\u786E\u5B9A"),G=x({__name:"catalogue-add-or-update",emits:["refreshDataList"],setup(K,{expose:D,emit:B}){const p=f(!1),n=f(),b=f([]),F=c("editorValues"),T=c("editableTabs"),V=c("currentNodeData"),t=I({orgId:"",parentId:"",parentPath:"",path:"",name:"",taskType:"",taskSqlType:"",orderNo:0,ifLeaf:1,description:""}),N=(s,e,i,o)=>{p.value=!0,n.value&&n.value.resetFields(),t.id="",n.value&&n.value.resetFields(),e?k(e).then(r=>{r.data&&E(r.data.orgId).then(m=>{b.value=m.data})}):E().then(r=>{b.value=r.data}),t.parentId=e,t.parentPath=i,t.ifLeaf=o,s&&q(s)},q=s=>{k(s).then(e=>{Object.assign(t,e.data)})},L=f({orgId:[{required:!0,message:"\u5FC5\u586B\u9879\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],name:[{required:!0,message:"\u5FC5\u586B\u9879\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],taskType:[{required:!0,message:"\u5FC5\u586B\u9879\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],taskSqlType:[{required:!0,message:"\u5FC5\u586B\u9879\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],orderNo:[{required:!0,message:"\u5FC5\u586B\u9879\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),y=()=>{n.value.validate(s=>{if(!s)return!1;R(t).then(()=>{if(t.id){let e=t.id+"";if(F[e]){F[e].nodeData=t,V.value.id==t.id&&(V.value=t);const i=T.value;for(let o in i){let r=i[o];if(r.name==e){r.title=t.name;break}}}}P.success({message:"\u64CD\u4F5C\u6210\u529F",duration:500,onClose:()=>{p.value=!1,B("refreshDataList")}})})})};return D({init:N}),(s,e)=>{const i=d("el-tree-select"),o=d("el-form-item"),r=d("el-input"),m=d("fast-select"),S=d("el-input-number"),U=d("el-form"),v=d("el-button"),h=d("el-dialog");return g(),_(h,{modelValue:p.value,"onUpdate:modelValue":e[10]||(e[10]=a=>p.value=a),title:t.id?"\u4FEE\u6539":"\u65B0\u589E","close-on-click-modal":!1},{footer:u(()=>[l(v,{onClick:e[8]||(e[8]=a=>p.value=!1)},{default:u(()=>[$]),_:1}),l(v,{type:"primary",onClick:e[9]||(e[9]=a=>y())},{default:u(()=>[j]),_:1})]),default:u(()=>[l(U,{ref_key:"dataFormRef",ref:n,model:t,rules:L.value,"label-width":"100px",onKeyup:e[7]||(e[7]=w(a=>y(),["enter"]))},{default:u(()=>[l(o,{prop:"orgId",label:"\u6240\u5C5E\u673A\u6784"},{default:u(()=>[l(i,{clearable:"",modelValue:t.orgId,"onUpdate:modelValue":e[0]||(e[0]=a=>t.orgId=a),data:b.value,"check-strictly":"","value-key":"id",props:{label:"name",children:"children"},style:{width:"100%"}},null,8,["modelValue","data"])]),_:1}),l(o,{label:"\u7236\u7EA7\u76EE\u5F55",prop:"parentPath"},{default:u(()=>[l(r,{disabled:"",modelValue:t.parentPath,"onUpdate:modelValue":e[1]||(e[1]=a=>t.parentPath=a),placeholder:""},null,8,["modelValue"])]),_:1}),l(o,{label:"\u540D\u79F0",prop:"name"},{default:u(()=>[l(r,{modelValue:t.name,"onUpdate:modelValue":e[2]||(e[2]=a=>t.name=a),placeholder:"\u540D\u79F0"},null,8,["modelValue"])]),_:1}),t.ifLeaf?C("",!0):(g(),_(o,{key:0,label:"\u4F5C\u4E1A\u7C7B\u578B",prop:"taskType"},{default:u(()=>[l(m,{disabled:!!t.id,modelValue:t.taskType,"onUpdate:modelValue":e[3]||(e[3]=a=>t.taskType=a),placeholder:"\u4F5C\u4E1A\u7C7B\u578B","dict-type":"production_task_type",clearable:""},null,8,["disabled","modelValue"])]),_:1})),t.taskType=="1"?(g(),_(o,{key:1,label:"SQL\u7C7B\u578B",prop:"taskSqlType"},{default:u(()=>[l(m,{modelValue:t.taskSqlType,"onUpdate:modelValue":e[4]||(e[4]=a=>t.taskSqlType=a),placeholder:"SQL\u7C7B\u578B","dict-type":"database_type",clearable:""},null,8,["modelValue"])]),_:1})):C("",!0),l(o,{label:"\u5E8F\u53F7",prop:"orderNo"},{default:u(()=>[l(S,{modelValue:t.orderNo,"onUpdate:modelValue":e[5]||(e[5]=a=>t.orderNo=a),max:9999,placeholder:"\u5E8F\u53F7"},null,8,["modelValue"])]),_:1}),l(o,{label:"\u63CF\u8FF0",prop:"description"},{default:u(()=>[l(r,{type:"textarea",modelValue:t.description,"onUpdate:modelValue":e[6]||(e[6]=a=>t.description=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}});export{G as _};
