import{d as j,h as b,K as S,X as B,r as s,o as d,f,w as u,b as l,G as i,c as m,e as G,F as H,a as E,t as P,a1 as X,l as p,al as z,E as J}from"./index.afa5927e.js";import{f as Q}from"./folder.ea536bf2.js";import{_ as W}from"./database.235d7a89.js";import{_ as Y}from"./table.e1c1b00a.js";import{_ as Z}from"./column.79595943.js";import{_ as ee}from"./model.45425835.js";import{c as te}from"./database.e836db09.js";import{u as ae,a as le}from"./metadataCollect.53667fb3.js";import{a as ue}from"./metadata.ec7a05f4.js";const oe=p("\u57FA\u672C\u914D\u7F6E"),se=p("\u91C7\u96C6\u914D\u7F6E"),de=p("\u6570\u636E\u5E93"),re=p("\u4E2D\u53F0\u5E93"),ne={key:0,src:Q},ie={key:1,src:W},me={key:2,src:Y},pe={key:3,src:Z},ce={key:4,src:ee},_e={style:{"margin-left":"8px"}},be=p("\u53D6\u6D88"),ge=p("\u786E\u5B9A"),Be=j({__name:"add-or-update",emits:["refreshDataList"],setup(fe,{expose:h,emit:I}){const y=b([]);S(()=>{w(),T()});const w=()=>{te().then(o=>{e.databaseList=o.data})},T=()=>{ue().then(o=>{V.value=o.data})},L=o=>{for(var t in e.databaseList){var _=e.databaseList[t];_.id==o&&Object.assign(U,_)}},c=b(!1),g=b(),V=b([]),U=B({}),e=B({orgId:"",name:"",strategy:"",taskType:"",cron:"",description:"",dbType:"",databaseId:"",metadataId:"",databaseList:[]}),q=o=>{c.value=!0,e.id="",g.value&&g.value.resetFields(),z().then(t=>{y.value=t.data}),o&&x(o)},x=o=>{ae(o).then(t=>{Object.assign(e,t.data)})},M=b({orgId:[{required:!0,message:"\u5FC5\u586B\u9879\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],name:[{required:!0,message:"\u5FC5\u586B\u9879\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],strategy:[{required:!0,message:"\u5FC5\u586B\u9879\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],taskType:[{required:!0,message:"\u5FC5\u586B\u9879\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],cron:[{required:!0,message:"\u5FC5\u586B\u9879\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],dbType:[{required:!0,message:"\u5FC5\u586B\u9879\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],databaseId:[{required:!0,message:"\u5FC5\u586B\u9879\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],metadataId:[{required:!0,message:"\u5FC5\u586B\u9879\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),A=()=>{g.value.validate(o=>{if(!o)return!1;e.databaseId=e.dbType==2?"":e.databaseId,e.cron=e.taskType==1?null:e.cron,le(e).then(()=>{J.success({message:"\u64CD\u4F5C\u6210\u529F",duration:500,onClose:()=>{c.value=!1,I("refreshDataList")}})})})};return h({init:q}),(o,t)=>{const _=s("el-divider"),C=s("el-tree-select"),r=s("el-form-item"),F=s("el-input"),D=s("fast-select"),v=s("el-radio"),$=s("el-radio-group"),N=s("el-option"),K=s("el-select"),O=s("el-form"),k=s("el-button"),R=s("el-dialog");return d(),f(R,{modelValue:c.value,"onUpdate:modelValue":t[12]||(t[12]=a=>c.value=a),title:e.id?"\u4FEE\u6539":"\u65B0\u589E","close-on-click-modal":!1},{footer:u(()=>[l(k,{onClick:t[10]||(t[10]=a=>c.value=!1)},{default:u(()=>[be]),_:1}),l(k,{type:"primary",onClick:t[11]||(t[11]=a=>A())},{default:u(()=>[ge]),_:1})]),default:u(()=>[l(O,{ref_key:"dataFormRef",ref:g,model:e,rules:M.value,"label-width":"100px",onKeyup:t[9]||(t[9]=X(a=>A(),["enter"]))},{default:u(()=>[l(_,null,{default:u(()=>[oe]),_:1}),l(r,{prop:"orgId",label:"\u6240\u5C5E\u673A\u6784","label-width":"auto"},{default:u(()=>[l(C,{clearable:"",modelValue:e.orgId,"onUpdate:modelValue":t[0]||(t[0]=a=>e.orgId=a),data:y.value,"check-strictly":"","value-key":"id",props:{label:"name",children:"children"},style:{width:"100%"}},null,8,["modelValue","data"])]),_:1}),l(r,{label:"\u540D\u79F0",prop:"name","label-width":"auto"},{default:u(()=>[l(F,{modelValue:e.name,"onUpdate:modelValue":t[1]||(t[1]=a=>e.name=a),placeholder:"\u540D\u79F0"},null,8,["modelValue"])]),_:1}),l(r,{label:"\u5165\u5E93\u7B56\u7565",prop:"strategy","label-width":"auto"},{default:u(()=>[l(D,{modelValue:e.strategy,"onUpdate:modelValue":t[2]||(t[2]=a=>e.strategy=a),"dict-type":"metadata_collect_strategy",placeholder:"\u8BF7\u9009\u62E9",clearable:""},null,8,["modelValue"])]),_:1}),l(r,{label:"\u4EFB\u52A1\u7C7B\u578B",prop:"taskType","label-width":"auto"},{default:u(()=>[l(D,{modelValue:e.taskType,"onUpdate:modelValue":t[3]||(t[3]=a=>e.taskType=a),"dict-type":"metadata_collect_type",placeholder:"\u8BF7\u9009\u62E9",clearable:""},null,8,["modelValue"])]),_:1}),e.taskType=="2"?(d(),f(r,{key:0,label:"cron\u8868\u8FBE\u5F0F",prop:"cron","label-width":"auto"},{default:u(()=>[l(F,{modelValue:e.cron,"onUpdate:modelValue":t[4]||(t[4]=a=>e.cron=a),placeholder:"cron\u8868\u8FBE\u5F0F"},null,8,["modelValue"])]),_:1})):i("",!0),l(r,{label:"\u63CF\u8FF0",prop:"description","label-width":"auto"},{default:u(()=>[l(F,{type:"textarea",rows:2,modelValue:e.description,"onUpdate:modelValue":t[5]||(t[5]=a=>e.description=a),placeholder:"\u63CF\u8FF0"},null,8,["modelValue"])]),_:1}),l(_,null,{default:u(()=>[se]),_:1}),l(r,{label:"\u6570\u636E\u6E90",prop:"dbType","label-width":"auto"},{default:u(()=>[l($,{modelValue:e.dbType,"onUpdate:modelValue":t[6]||(t[6]=a=>e.dbType=a),disabled:!!e.id},{default:u(()=>[l(v,{label:1,border:""},{default:u(()=>[de]),_:1}),l(v,{label:2,border:""},{default:u(()=>[re]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1}),e.dbType=="1"?(d(),f(r,{key:1,label:"\u6570\u636E\u5E93",prop:"databaseId","label-width":"auto"},{default:u(()=>[l(K,{modelValue:e.databaseId,"onUpdate:modelValue":t[7]||(t[7]=a=>e.databaseId=a),disabled:!!e.id,clearable:"",filterable:"",onChange:L,placeholder:"\u8BF7\u9009\u62E9"},{default:u(()=>[(d(!0),m(H,null,G(e.databaseList,(a,n)=>(d(),f(N,{key:a.id,label:`[${a.id}]${a.name}`,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})):i("",!0),l(r,{label:"\u5F52\u5C5E\u5143\u6570\u636E\u76EE\u5F55",prop:"metadataId","label-width":"auto"},{default:u(()=>[l(C,{disabled:!!e.id,modelValue:e.metadataId,"onUpdate:modelValue":t[8]||(t[8]=a=>e.metadataId=a),data:V.value,clearable:""},{default:u(({node:a,data:n})=>[E("div",null,[E("span",null,[n.icon=="/src/assets/folder.png"?(d(),m("img",ne)):i("",!0),n.icon=="/src/assets/database.png"?(d(),m("img",ie)):i("",!0),n.icon=="/src/assets/table.png"?(d(),m("img",me)):i("",!0),n.icon=="/src/assets/column.png"?(d(),m("img",pe)):i("",!0),n.icon=="/src/assets/model.png"?(d(),m("img",ce)):i("",!0),E("span",_e,P(n.name),1)])])]),_:1},8,["disabled","modelValue","data"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}});export{Be as _};
