import{ad as f,d as I,K as R,h as n,X as Q,r,o as _,f as v,w as a,b as u,a as c,t as $,G as C,a1 as K,l as E,al as O,E as b}from"./index.afa5927e.js";import{e as j}from"./database.e836db09.js";import z from"./sql-studio.0badaa6b.js";const G=s=>f.get("/data-governance/label-model/"+s),H=s=>s.id?f.put("/data-governance/label-model",s):f.post("/data-governance/label-model",s),P=s=>f.post("/data-governance/label-model/check-sql",{sql:s}),X={style:{"padding-bottom":"5px"}},J=E("\u68C0\u67E5sql"),W={style:{height:"150px",width:"600px"}},Y=E("\u53D6\u6D88"),Z=E("\u786E\u5B9A"),ue=I({__name:"add-or-update",emits:["refreshDataList"],setup(s,{expose:q,emit:B}){R(()=>{j().then(o=>{F.value=o.data[0].children})});const D=n({value:"name",children:"children",label:"name"}),F=n([]),i=n(!1),p=n(),y=n([]),m=n(),e=Q({orgId:"",name:"",description:"",type:"",tableNameAll:[],tableName:"",sqlText:""}),h=o=>{i.value=!0,e.id="",p.value&&p.value.resetFields(),O().then(l=>{y.value=l.data}),o&&k(o)},k=o=>{G(o).then(l=>{Object.assign(e,l.data),e.sqlText&&setTimeout(()=>{m.value.setEditorValue(e.sqlText)},300)})},w=n({orgId:[{required:!0,message:"\u5FC5\u586B\u9879\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],name:[{required:!0,message:"\u5FC5\u586B\u9879\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],type:[{required:!0,message:"\u5FC5\u586B\u9879\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],tableNameAll:[{required:!0,message:"\u5FC5\u586B\u9879\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],sqlText:[{required:!0,message:"\u5FC5\u586B\u9879\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),x=()=>{const o=m.value.getEditorValue();o||b.warning("\u8BF7\u586B\u5199 SQL \u8BED\u53E5\uFF08\u5355\u6761 SELECT\uFF09\uFF01"),P(o).then(l=>{l.data.success?b.success("SQL\u68C0\u6D4B\u6210\u529F\uFF0C\u53EF\u4EE5\u6B63\u5E38\u6267\u884C"):b.error("SQL\u68C0\u6D4B\u6709\u8BEF\uFF1A"+l.data.errorMsg)})},A=()=>{e.type==2&&(e.sqlText=m.value.getEditorValue()),p.value.validate(o=>{if(!o)return!1;e.type==1&&(e.tableName=e.tableNameAll[1],e.sqlText=null),e.type==2&&(e.tableName=null,e.tableNameAll=null),H(e).then(()=>{b.success({message:"\u64CD\u4F5C\u6210\u529F",duration:500,onClose:()=>{i.value=!1,B("refreshDataList")}})})})};return q({init:h}),(o,l)=>{const S=r("el-tree-select"),d=r("el-form-item"),V=r("el-input"),L=r("fast-select"),N=r("el-cascader"),g=r("el-button"),T=r("el-form"),M=r("el-dialog");return _(),v(M,{modelValue:i.value,"onUpdate:modelValue":l[9]||(l[9]=t=>i.value=t),title:e.id?"\u4FEE\u6539":"\u65B0\u589E","close-on-click-modal":!1,width:"60%"},{footer:a(()=>[u(g,{onClick:l[7]||(l[7]=t=>i.value=!1)},{default:a(()=>[Y]),_:1}),u(g,{type:"primary",onClick:l[8]||(l[8]=t=>A())},{default:a(()=>[Z]),_:1})]),default:a(()=>[u(T,{ref_key:"dataFormRef",ref:p,model:e,rules:w.value,"label-width":"100px",onKeyup:l[6]||(l[6]=K(t=>A(),["enter"]))},{default:a(()=>[u(d,{prop:"orgId",label:"\u6240\u5C5E\u673A\u6784","label-width":"auto"},{default:a(()=>[u(S,{clearable:"",modelValue:e.orgId,"onUpdate:modelValue":l[0]||(l[0]=t=>e.orgId=t),data:y.value,"check-strictly":"","value-key":"id",props:{label:"name",children:"children"},style:{width:"100%"}},null,8,["modelValue","data"])]),_:1}),u(d,{label:"\u540D\u79F0",prop:"name","label-width":"auto"},{default:a(()=>[u(V,{modelValue:e.name,"onUpdate:modelValue":l[1]||(l[1]=t=>e.name=t),placeholder:"\u540D\u79F0"},null,8,["modelValue"])]),_:1}),u(d,{label:"\u7C7B\u578B",prop:"type","label-width":"auto"},{default:a(()=>[u(L,{modelValue:e.type,"onUpdate:modelValue":l[2]||(l[2]=t=>e.type=t),"dict-type":"label_model_type",placeholder:"\u7C7B\u578B",clearable:"",filterable:""},null,8,["modelValue"])]),_:1}),e.type==1?(_(),v(d,{key:0,label:"\u9009\u62E9\u8868",prop:"type","label-width":"auto"},{default:a(()=>[u(N,{modelValue:e.tableNameAll,"onUpdate:modelValue":l[3]||(l[3]=t=>e.tableNameAll=t),style:{width:"100%"},clearable:"","show-all-levels":!0,props:D.value,options:F.value},{default:a(({node:t,data:U})=>[c("span",null,$(U.name),1)]),_:1},8,["modelValue","props","options"])]),_:1})):C("",!0),e.type==2?(_(),v(d,{key:1,label:"SQL",prop:"sqlText","label-width":"auto"},{default:a(()=>[c("div",null,[c("div",X,[u(g,{type:"warning",size:"small",onClick:l[4]||(l[4]=t=>x())},{default:a(()=>[J]),_:1})]),c("div",W,[u(z,{ref_key:"sqlStudioRef",ref:m,id:"labelModelSql"},null,512)])])]),_:1})):C("",!0),u(d,{label:"\u8BF4\u660E",prop:"description","label-width":"auto"},{default:a(()=>[u(V,{type:"textarea",modelValue:e.description,"onUpdate:modelValue":l[5]||(l[5]=t=>e.description=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}});export{ue as _};
