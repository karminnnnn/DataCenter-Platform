import{d as W,K as Y,h as n,X as x,r as d,o as s,f as _,w as r,b as t,G as m,a as E,c as g,t as Z,a1 as ee,a6 as w,a7 as N,e as le,F as ae,l as y,al as R,E as te}from"./index.afa5927e.js";import{f as ue}from"./folder.ea536bf2.js";import{_ as oe}from"./database.235d7a89.js";import{_ as re}from"./table.e1c1b00a.js";import{_ as se}from"./column.79595943.js";import{_ as de}from"./model.45425835.js";import{l as ne}from"./metamodel.c598c349.js";import{b as q,c as ie,d as me}from"./metadata.ec7a05f4.js";const pe={key:0,src:ue},fe={key:1,src:oe},ce={key:2,src:re},_e={key:3,src:se},ve={key:4,src:de},ge={style:{"margin-left":"8px"}},be=y("\u5143\u6570\u636E\u5C5E\u6027"),Fe=y("\u53D6\u6D88"),Ee=y("\u786E\u5B9A"),Ie=W({__name:"add-or-update",emits:["refreshDataList"],setup(Ve,{expose:M,emit:S}){Y(()=>{ne().then(o=>{D.value=o.data})});const b=n(!1),V=n(),A=n(),C=n([]),D=n([]);n();const l=x({orgId:"",parentId:"",parentPath:"",path:"",name:"",code:"",ifLeaf:1,metamodelId:"",orderNo:0,description:""}),F=x({}),K=(o,e,p)=>{b.value=!0,l.id="",V.value&&V.value.resetFields(),l.metamodelId="",F.value&&F.value.resetFields(),l.ifLeaf=l.parentId==0?1:l.ifLeaf,l.parentId=e,l.parentPath=p,e?q(e).then(u=>{u.data&&R(u.data.orgId).then(f=>{C.value=f.data})}):R().then(u=>{C.value=u.data}),o&&O(o)},O=o=>{q(o).then(e=>{Object.assign(l,e.data),i.value=e.data.properties,i.value.length>0?v.value=!0:v.value=!1,B()})},$=n({orgId:[{required:!0,message:"\u5FC5\u586B\u9879\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],name:[{required:!0,message:"\u5FC5\u586B\u9879\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],code:[{required:!0,message:"\u5FC5\u586B\u9879\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],ifLeaf:[{required:!0,message:"\u5FC5\u586B\u9879\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],metamodelId:[{required:!0,message:"\u5FC5\u586B\u9879\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],orderNo:[{required:!0,message:"\u5FC5\u586B\u9879\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),k=n({}),i=n([]),v=n(!1),T=o=>{o&&ie(o).then(e=>{i.value=e.data,i.value.length>0?v.value=!0:v.value=!1,B()})},B=()=>{for(var o in i.value){var e=i.value[o];if(e.value=e.value?e.value:"",F[e.code]=e.value?e.value:"",e.nullable==0){let p=[],u={};u.required=!0,u.message="\u5FC5\u586B\u9879\u4E0D\u80FD\u4E3A\u7A7A",u.trigger="blur",p.push(u),k.value[e.code]=p}}},j=(o,e)=>{F[e.code]=o},L=async()=>{let o=!0;await V.value.validate(e=>{if(!e)return o=!1,!1}),A.value&&await A.value.validate(e=>{if(!e)return o=!1,!1}),o&&G()},G=()=>{l.metamodelId=l.ifLeaf==1?"":l.metamodelId,l.properties=i.value,me(l).then(()=>{te.success({message:"\u64CD\u4F5C\u6210\u529F",duration:500,onClose:()=>{b.value=!1,S("refreshDataList")}})})};return M({init:K}),(o,e)=>{const p=d("el-tree-select"),u=d("el-form-item"),f=d("el-input"),I=d("el-option"),H=d("el-select"),X=d("el-input-number"),P=d("el-form"),z=d("el-divider"),J=d("el-result"),U=d("el-button"),Q=d("el-dialog");return s(),_(Q,{modelValue:b.value,"onUpdate:modelValue":e[11]||(e[11]=a=>b.value=a),title:l.id?"\u4FEE\u6539":"\u65B0\u589E","close-on-click-modal":!1},{footer:r(()=>[t(U,{onClick:e[9]||(e[9]=a=>b.value=!1)},{default:r(()=>[Fe]),_:1}),t(U,{type:"primary",onClick:e[10]||(e[10]=a=>L())},{default:r(()=>[Ee]),_:1})]),default:r(()=>[t(P,{ref_key:"dataFormRef",ref:V,model:l,rules:$.value,"label-width":"100px",onKeyup:e[8]||(e[8]=ee(a=>L(),["enter"]))},{default:r(()=>[t(u,{prop:"orgId",label:"\u6240\u5C5E\u673A\u6784"},{default:r(()=>[t(p,{clearable:"",modelValue:l.orgId,"onUpdate:modelValue":e[0]||(e[0]=a=>l.orgId=a),data:C.value,"check-strictly":"","value-key":"id",props:{label:"name",children:"children"},style:{width:"100%"}},null,8,["modelValue","data"])]),_:1}),t(u,{label:"\u7236\u7EA7\u76EE\u5F55",prop:"parentPath"},{default:r(()=>[t(f,{disabled:"",modelValue:l.parentPath,"onUpdate:modelValue":e[1]||(e[1]=a=>l.parentPath=a),placeholder:""},null,8,["modelValue"])]),_:1}),t(u,{label:"\u540D\u79F0",prop:"name"},{default:r(()=>[t(f,{modelValue:l.name,"onUpdate:modelValue":e[2]||(e[2]=a=>l.name=a),placeholder:"\u540D\u79F0"},null,8,["modelValue"])]),_:1}),t(u,{label:"\u7F16\u7801",prop:"code"},{default:r(()=>[t(f,{modelValue:l.code,"onUpdate:modelValue":e[3]||(e[3]=a=>l.code=a),placeholder:"\u7F16\u7801"},null,8,["modelValue"])]),_:1}),l.parentId!=0?(s(),_(u,{key:0,label:"\u7C7B\u578B",prop:"ifLeaf"},{default:r(()=>[t(H,{disabled:!!l.id,modelValue:l.ifLeaf,"onUpdate:modelValue":e[4]||(e[4]=a=>l.ifLeaf=a),placeholder:"\u7C7B\u578B"},{default:r(()=>[(s(),_(I,{key:1,label:"\u76EE\u5F55",value:1})),(s(),_(I,{key:0,label:"\u5143\u6570\u636E",value:0}))]),_:1},8,["disabled","modelValue"])]),_:1})):m("",!0),l.ifLeaf==0?(s(),_(u,{key:1,label:"\u6240\u5C5E\u5143\u6A21\u578B",prop:"metamodelId"},{default:r(()=>[t(p,{disabled:!!l.id,modelValue:l.metamodelId,"onUpdate:modelValue":e[5]||(e[5]=a=>l.metamodelId=a),data:D.value,clearable:"",onChange:T},{default:r(({node:a,data:c})=>[E("div",null,[E("span",null,[c.icon=="/src/assets/folder.png"?(s(),g("img",pe)):m("",!0),c.icon=="/src/assets/database.png"?(s(),g("img",fe)):m("",!0),c.icon=="/src/assets/table.png"?(s(),g("img",ce)):m("",!0),c.icon=="/src/assets/column.png"?(s(),g("img",_e)):m("",!0),c.icon=="/src/assets/model.png"?(s(),g("img",ve)):m("",!0),E("span",ge,Z(c.name),1)])])]),_:1},8,["disabled","modelValue","data"])]),_:1})):m("",!0),t(u,{label:"\u5E8F\u53F7",prop:"orderNo"},{default:r(()=>[t(X,{modelValue:l.orderNo,"onUpdate:modelValue":e[6]||(e[6]=a=>l.orderNo=a),max:9999,placeholder:"\u5E8F\u53F7"},null,8,["modelValue"])]),_:1}),t(u,{label:"\u63CF\u8FF0",prop:"description"},{default:r(()=>[t(f,{type:"textarea",modelValue:l.description,"onUpdate:modelValue":e[7]||(e[7]=a=>l.description=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),!!l.metamodelId&&l.ifLeaf==0?(s(),_(P,{key:0,ref_key:"dataPropertyFormRef",ref:A,model:F,rules:k.value,"label-width":"100px"},{default:r(()=>[t(z,{"content-position":"left"},{default:r(()=>[be]),_:1}),w(E("div",null,[(s(!0),g(ae,null,le(i.value,(a,c)=>(s(),_(u,{label:a.name,prop:a.code},{default:r(()=>[t(f,{onChange:h=>j(h,a),modelValue:a.value,"onUpdate:modelValue":h=>a.value=h,placeholder:a.name},null,8,["onChange","modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["label","prop"]))),256))],512),[[N,v.value]]),w(E("div",null,[t(J,{title:"\u65E0\u5C5E\u6027","sub-title":"\u6CA1\u6709\u9700\u8981\u6DFB\u52A0\u7684\u5C5E\u6027\u4FE1\u606F"})],512),[[N,!v.value]])]),_:1},8,["model","rules"])):m("",!0)]),_:1},8,["modelValue","title"])}}});export{Ie as _};
