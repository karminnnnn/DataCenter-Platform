import{d as te,h as c,A as _e,O as ge,K as be,a5 as C,X as he,r as _,o as L,f as z,w as u,a as d,a6 as M,a7 as X,b as o,G as Q,c as Ee,e as ye,F as Be,l as ae,E as k,a8 as Ce,a9 as W}from"./index.afa5927e.js";import{_ as xe,a as De}from"./run.cf98bfe1.js";import{_ as Fe,a as Ae}from"./clear.9e45766d.js";import{_ as Ne}from"./db.vue_vue_type_style_index_0_lang.6cb4d8b1.js";import{_ as Re}from"./middle-db.vue_vue_type_style_index_0_lang.feb6e5c4.js";import{_ as Te}from"./explainSql.vue_vue_type_script_setup_true_lang.11cbea20.js";import{_ as ke,c as J,e as Z,a as P,j as we,g as Ve,b as Ie}from"./console-result.vue_vue_type_script_setup_true_lang.ee7703c2.js";import Se from"./data-studio.dc729243.js";import{_ as qe}from"./readonly-studio.vue_vue_type_script_setup_true_lang.c5082512.js";import{l as ee,s as Le}from"./resourceMount.b8c1bb2a.js";import"./database.e836db09.js";import"./database.235d7a89.js";import"./table.e1c1b00a.js";import"./house.1ac0c09f.js";import"./ts.worker.921d436c.js";import"./toggleHighContrast.9f64e070.js";import"./sqlFormatter.e0a34ad5.js";import"./sql.4f48b9c1.js";const We={class:"headerBox"},ze={calss:"headRight"},Me=d("img",{src:xe},null,-1),Xe=d("img",{src:Fe},null,-1),$e=d("img",{src:De},null,-1),je=d("img",{src:Ae},null,-1),Oe={class:"box"},He={class:"mainBox"},Ue={class:"left"},Ye=d("div",{class:"leftResize",title:"\u5DE6\u53F3\u4FA7\u8FB9\u680F"},null,-1),Je={class:"midBox"},Ke={style:{height:"100%"}},Ge=d("div",{class:"rightResize",title:"\u5DE6\u53F3\u4FA7\u8FB9\u680F"},null,-1),Qe={class:"right"},Ze={style:{padding:"30px 20px"}},Pe=d("div",{title:"\u4E0A\u4E0B\u4FA7\u8FB9\u680F",class:"bottomResize"},null,-1),et={class:"downBox"},tt={class:"custom-tabs-label"},at=ae("\xA0 "),lt=d("span",null,"\u65E5\u5FD7\u4FE1\u606F",-1),ot={class:"custom-tabs-label"},st=ae("\xA0 "),ut=d("span",null,"\u7ED3\u679C",-1),nt=te({name:"DataAssetsDbResource"}),At=te({...nt,setup(it){const $=c("database"),w=c(),V=c(),le=_e(),D=c(),j=c();ge(()=>le.currentRoute.value.query.id,(e,t)=>{if(!e)return;let n=sessionStorage.getItem("resourceId");n!=D.value&&D.value&&O(),D.value=n;let i=sessionStorage.getItem("queryApply");ee(D.value,i).then(l=>{j.value&&JSON.stringify(j.value)!=JSON.stringify(l.data)&&O(),j.value=l.data,l.data.DATABASE.length?(N.value=!0,setTimeout(()=>{w.value.init(sessionStorage.getItem("resourceId"),l.data.DATABASE)},300)):(N.value=!1,$.value="middledb"),l.data.MIDDLE_DB.length?(R.value=!0,setTimeout(()=>{V.value.init(sessionStorage.getItem("resourceId"),l.data.MIDDLE_DB)},300)):R.value=!1,!N.value&&!R.value&&k.warning("\u6CA1\u6709\u53EF\u4EE5\u67E5\u770B\u7684\u6709\u6548\u5E93\u8868\u8D44\u6E90\uFF01")})},{immediate:!0}),be(()=>{fe(),ve(),pe(),D.value=sessionStorage.getItem("resourceId");let e=sessionStorage.getItem("queryApply");O(),ee(D.value,e).then(t=>{t.data.DATABASE.length?(N.value=!0,setTimeout(()=>{w.value.init(sessionStorage.getItem("resourceId"),t.data.DATABASE)},300)):N.value=!1,t.data.MIDDLE_DB.length?(R.value=!0,setTimeout(()=>{V.value.init(sessionStorage.getItem("resourceId"),t.data.MIDDLE_DB)},300)):R.value=!1})});const O=()=>{K.value="";for(let e in p)delete p[e];I.value=[],v.value="0",setTimeout(()=>{T.value.setEditorValue(""),q.value.clear()},200)},K=c(""),v=c("0"),I=c([]),F=c(),A=c(),p={},N=c(!1),R=c(!1);C("filterNodeText",K),C("editorValues",p),C("editableTabsValue",v),C("editableTabs",I),C("currentNodeData",A),C("hasDb",N),C("hasMiddledb",R);const G=()=>{F.value.setEditorValue(p[v.value]?p[v.value].codeText:"")},oe=e=>{v.value=e.paneName,A.value=p[e.paneName]?p[e.paneName].nodeData:{},F.value.setEditorValue(p[e.paneName]?p[e.paneName].codeText:"")},se=e=>{Ce.confirm("\u786E\u8BA4\u5173\u95ED\u5417\uFF1F","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{ue(e)})},ue=e=>{const t=I.value;let n=v.value;var i=!1,l=!1;for(let f in t)if(t[Number(f)].name==e){l=!0;const y=t[Number(f)+1]||t[Number(f)-1];if(y){i=!0,n=y.name;break}}!l||(i?v.value=n:v.value="0",I.value=t.filter(f=>f.name!=e),delete p[e],F.value.setEditorValue(p[n]?p[n].codeText:""),A.value=p[n]?p[n].nodeData:{})},ne=()=>{F.value.handleFormat()},s=he({saveHistory:0,statement:"",dialect:1,sqlDbType:1,databaseId:"",pvdataNum:100,openTrans:0,processEnd:!0}),ie=c({pvdataNum:[{required:!0,message:"\u5FC5\u586B\u9879\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),H=c(),S=c(),re=async()=>{let e=!0;if(await H.value.validate(n=>{if(!n)return k.warning("\u8BF7\u628A\u5FC5\u586B\u9879\u8865\u5145\u5B8C\u6574\uFF01"),e=!1,!1}),!e)return;A.value.type==1?(s.sqlDbType=2,s.databaseId=null):(s.sqlDbType=1,s.databaseId=A.value.id),S.value.init(),s.jobName=s.name,s.maxRowNum=s.pvdataNum,s.statement=F.value.getEditorValue(),await J(),Y();const{data:t}=await Z(s);S.value.finishExplain(t)},U=c(),q=c(),de=async()=>{let e=!0;U.value=!0;try{if(await H.value.validate(i=>{if(!i)return k.warning("\u8BF7\u628A\u5FC5\u586B\u9879\u8865\u5145\u5B8C\u6574\uFF01"),e=!1,!1}),!e)return;A.value.type==1?(s.sqlDbType=2,s.databaseId=null):(s.sqlDbType=1,s.databaseId=A.value.id),s.jobName=s.name,s.maxRowNum=s.pvdataNum,s.statement=F.value.getEditorValue(),await J(),Y(),W({title:"\u63D0\u793A",message:"\u6B63\u5728\u68C0\u67E5sql\u8BED\u53E5\u6B63\u786E\u6027\u3002\u3002\u3002",duration:0,zIndex:9999,type:"success"}),s.processEnd=!1;const{data:t}=await Z(s);s.processEnd=!0;const n=S.value.finishExplain(t);if(W.closeAll(),n){W({title:"\u63D0\u793A",message:"\u6B63\u5728\u6267\u884Csql\uFF0C\u8BF7\u8010\u5FC3\u7B49\u5F85\u3002\u3002\u3002",duration:0,zIndex:9999,type:"success"}),s.resourceId=D.value;const i=await Le(s);if(!i.data.pass){k.error(i.data.msg),P();return}const{data:l}=await we(s);if(W.closeAll(),!l.success){k.error("\u6267\u884C\u5931\u8D25\uFF0C\u8BF7\u67E5\u770B\u65E5\u5FD7\u4FE1\u606F\u6392\u67E5\u539F\u56E0\uFF01"),q.value.init(l.result,1);return}k.success("\u6267\u884C\u6210\u529F"),q.value.init(l.result,1)}else S.value.showError(),P()}finally{U.value=!1,W.closeAll()}},T=c();C("consoleLogRef",T),C("consoleResultRef",q);const Y=()=>{Ve().then(e=>{e.data.log!=T.value.getEditorValue()&&T.value.setEditorValue(e.data.log),e.data.end?J():setTimeout(()=>{Y()},1e3)})},me=()=>{T.value.setEditorValue(""),Ie()},ce=e=>{w.value&&w.value.OptionCardClose(),V.value&&V.value.OptionCardClose()},fe=()=>{var e=document.getElementsByClassName("leftResize"),t=document.getElementsByClassName("rightResize"),n=document.getElementsByClassName("left"),i=document.getElementsByClassName("right"),l=document.getElementsByClassName("midBox"),f=document.getElementsByClassName("mainBox");for(let a=0;a<e.length;a++)e[a].onmousedown=function(y){e[a].style.background="#818181";var x=y.clientX,m=e[a].offsetLeft,B=f[a].clientWidth-t[a].offsetWidth-t[a].offsetLeft;return document.onmousemove=function(h){var g=h.clientX,b=m+(g-x),E=f[a].clientWidth-e[a].offsetWidth-t[a].offsetWidth-B;b<=100&&(b=100),b>=E-120&&(b=E-120),e[a].style.left=b;for(let r=0;r<n.length;r++)n[r].style.width=b+"px",i[r].style.width=B-1+"px",l[r]&&(l[r].style.width=E-b-36+"px")},document.onmouseup=function(h){e[a].style.background="#d6d6d6",document.onmousemove=null,document.onmouseup=null,e[a].releaseCapture&&e[a].releaseCapture()},e[a].setCapture&&e[a].setCapture(),!1}},ve=()=>{var e=document.getElementsByClassName("leftResize"),t=document.getElementsByClassName("rightResize"),n=document.getElementsByClassName("left"),i=document.getElementsByClassName("right"),l=document.getElementsByClassName("midBox"),f=document.getElementsByClassName("mainBox");for(let a=0;a<t.length;a++)t[a].onmousedown=function(y){t[a].style.background="#818181";var x=y.clientX;t[a].left=t[a].offsetLeft;var m=n[a].offsetWidth;return console.log(m),document.onmousemove=function(B){var h=B.clientX,g=t[a].left+(h-x),b=f[a].clientWidth-e[a].offsetWidth-t[a].offsetWidth-m;g-e[a].offsetWidth-m<=120&&(g=120+e[a].offsetWidth+m),g-e[a].offsetWidth-m+100>=b&&(g=b-100+e[a].offsetWidth+m),t[a].style.left=g;for(let E=0;E<i.length;E++)l[E]&&(l[E].style.width=g-e[a].offsetWidth-m+"px"),i[E].style.width=f[a].clientWidth-g-t[a].offsetWidth-1+"px"},document.onmouseup=function(B){t[a].style.background="#d6d6d6",document.onmousemove=null,document.onmouseup=null,t[a].releaseCapture&&t[a].releaseCapture()},t[a].setCapture&&t[a].setCapture(),!1}},pe=()=>{var e=document.getElementsByClassName("bottomResize"),t=document.getElementsByClassName("mainBox"),n=document.getElementsByClassName("downBox"),i=document.getElementsByClassName("box");for(let l=0;l<e.length;l++)e[l].onmousedown=function(f){console.log(e[l].top),e[l].style.background="#818181";var a=f.clientY;return e[l].top=e[l].offsetTop,document.onmousemove=function(y){var x=y.clientY,m=e[l].top+(x-a),B=i[l].clientHeight-e[l].offsetHeight;m<100&&(m=100),m>B-80&&(m=B-80),e[l].style.top=m;for(let h=0;h<t.length;h++)t[h].style.height=m+"px",n[h].style.height=i[l].clientHeight-m-e[l].offsetHeight+"px"},document.onmouseup=function(){e[l].style.background="#d6d6d6",document.onmousemove=null,document.onmouseup=null,e[l].releaseCapture&&e[l].releaseCapture()},e[l].setCapture&&e[l].setCapture(),!1}};return(e,t)=>{const n=_("el-button"),i=_("el-tooltip"),l=_("el-tab-pane"),f=_("el-tabs"),a=_("el-scrollbar"),y=_("el-input-number"),x=_("el-form-item"),m=_("el-switch"),B=_("el-form"),h=_("Postcard"),g=_("el-icon"),b=_("DataLine"),E=_("el-card");return L(),z(E,{onClick:t[7]||(t[7]=r=>ce())},{default:u(()=>[d("div",We,[M(d("div",ze,[o(i,{class:"box-item",effect:"dark",content:"\u7F8E\u5316sql",placement:"top-end"},{default:u(()=>[o(n,{text:"",onClick:t[0]||(t[0]=r=>ne())},{default:u(()=>[Me]),_:1})]),_:1}),o(i,{class:"box-item",effect:"dark",content:"\u68C0\u67E5sql\u6709\u6548\u6027",placement:"top-end"},{default:u(()=>[o(n,{text:"",onClick:t[1]||(t[1]=r=>re())},{default:u(()=>[Xe]),_:1})]),_:1}),o(i,{class:"box-item",effect:"dark",content:"\u6267\u884C",placement:"top-end"},{default:u(()=>[o(n,{loading:U.value,onClick:t[2]||(t[2]=r=>de()),text:""},{default:u(()=>[$e]),_:1},8,["loading"])]),_:1}),o(i,{class:"box-item",effect:"dark",content:"\u6E05\u7A7A\u65E5\u5FD7",placement:"top-end"},{default:u(()=>[o(n,{onClick:me,text:""},{default:u(()=>[je]),_:1})]),_:1})],512),[[X,v.value!="0"]])]),d("div",Oe,[d("div",He,[d("div",Ue,[o(a,null,{default:u(()=>[o(f,{class:"demo-tabs",modelValue:$.value,"onUpdate:modelValue":t[3]||(t[3]=r=>$.value=r)},{default:u(()=>[N.value?(L(),z(l,{key:0,label:"\u6570\u636E\u5E93",name:"database"},{default:u(()=>[o(Ne,{ref_key:"dbRef",ref:w,onSetCodeText:G},null,512)]),_:1})):Q("",!0),R.value?(L(),z(l,{key:1,label:"\u4E2D\u53F0\u5E93",name:"middledb"},{default:u(()=>[o(Re,{ref_key:"middledbRef",ref:V,onSetCodeText:G},null,512)]),_:1})):Q("",!0)]),_:1},8,["modelValue"])]),_:1})]),Ye,d("div",Je,[o(f,{class:"mid-tabs",modelValue:v.value,"onUpdate:modelValue":t[4]||(t[4]=r=>v.value=r),type:"card",closable:"",onTabRemove:se,onTabClick:oe},{default:u(()=>[(L(!0),Ee(Be,null,ye(I.value,r=>(L(),z(l,{key:r.name,label:r.title,name:r.name},null,8,["label","name"]))),128))]),_:1},8,["modelValue"]),M(d("div",Ke,[M(o(Se,{id:"dbResourceStudio",ref_key:"dataStudioRef",ref:F},null,512),[[X,v.value!="0"]])],512),[[X,v.value!="0"]])]),Ge,d("div",Qe,[o(a,null,{default:u(()=>[M(d("div",Ze,[o(B,{ref_key:"sqlDataFormRef",ref:H,model:s,rules:ie.value},{default:u(()=>[o(x,{label:"\u6570\u636E\u9884\u89C8\u6700\u5927\u884C\u6570",prop:"pvdataNum"},{default:u(()=>[o(y,{modelValue:s.pvdataNum,"onUpdate:modelValue":t[5]||(t[5]=r=>s.pvdataNum=r),min:1,max:1e3},null,8,["modelValue"])]),_:1}),o(x,{label:"\u5F00\u542F\u4E8B\u52A1",prop:"openTrans"},{default:u(()=>[o(i,{effect:"dark",content:"\u5982\u679C\u6570\u636E\u5E93\u672C\u8EAB\u4E0D\u652F\u6301\u4E8B\u52A1, \u5219\u4E0D\u8981\u5F00\u542F",placement:"top-end"},{default:u(()=>[o(m,{modelValue:s.openTrans,"onUpdate:modelValue":t[6]||(t[6]=r=>s.openTrans=r),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["model","rules"])],512),[[X,v.value!="0"]])]),_:1})])]),Pe,d("div",et,[o(f,{class:"buttom-tabs"},{default:u(()=>[o(l,null,{label:u(()=>[d("span",tt,[o(g,null,{default:u(()=>[o(h)]),_:1}),at,lt])]),default:u(()=>[o(qe,{id:"resourceConsoleLog",ref_key:"consoleLogRef",ref:T,style:{height:"100%"}},null,512)]),_:1}),o(l,null,{label:u(()=>[d("span",ot,[o(g,null,{default:u(()=>[o(b)]),_:1}),st,ut])]),default:u(()=>[o(ke,{ref_key:"consoleResultRef",ref:q},null,512)]),_:1})]),_:1})])]),o(Te,{ref_key:"explainSqlDialogRef",ref:S},null,512)]),_:1})}}});export{At as default};
