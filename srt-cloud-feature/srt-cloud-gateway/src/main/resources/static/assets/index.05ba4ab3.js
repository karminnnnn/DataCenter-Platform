import{d as ee,K as Me,h as m,X as Q,O as Se,r as h,aj as Oe,o,f as _,w as t,a as s,b as u,c as y,G as D,t as f,a6 as S,a7 as z,F as W,k as V,ao as Re,s as X,ac as Z,v as Ie,e as $e,l as r,a8 as O,E as B}from"./index.afa5927e.js";import{f as Pe}from"./folder.ea536bf2.js";import{_ as je}from"./assets.b509e60a.js";import{_ as ze}from"./index.vue_vue_type_style_index_0_lang.20b2a492.js";import{_ as Xe}from"./add-or-update.vue_vue_type_script_setup_true_lang.a59d57a9.js";import{l as Ye,d as qe}from"./masterDataCatalog.f5a68431.js";import{g as Je}from"./masterColumn.c69a7c93.js";import{g as Ge,d as Ke,u as He,s as Qe,r as We,c as Ze}from"./masterModel.c39d5caf.js";import{e as el}from"./database.e836db09.js";const ll=s("div",{slot:"left-title",class:"rm-left-title"},[s("span",null,"\u4E3B\u6570\u636E\u76EE\u5F55")],-1),tl={style:{height:"100%"},class:"masterDataTreeDiv"},al=s("br",null,null,-1),ul=s("br",null,null,-1),ol=r("\u6DFB\u52A0\u6839\u76EE\u5F55"),nl=s("br",null,null,-1),sl=s("br",null,null,-1),dl={class:"masterData-tree-node"},il={key:0,src:Pe},rl={key:1,src:je},cl={style:{"margin-left":"8px"}},pl={class:"master-data-right"},_l={class:"action_part"},fl=r("\u4FDD\u5B58"),ml=r("\u7F16\u8F91"),hl=r("\u5220\u9664"),vl=r("\u53D1\u5E03"),yl=r("\u53D6\u6D88\u53D1\u5E03"),gl=r("\u53D6\u6D88"),bl={class:"dsr-part"},Cl={class:"info-part"},Dl=s("h6",null,"\u8868\u4FE1\u606F",-1),Bl={key:1},kl={key:1},El={key:1},Fl={class:"info-part field-part"},wl=s("h6",null,"\u5B57\u6BB5\u7BA1\u7406",-1),Vl={class:"sheet-field"},Al=r("\u6DFB\u52A0\u5B57\u6BB5"),xl=r(" \u4ECE\u5DF2\u6709\u8868\u62FE\u53D6\u5B57\u6BB5"),Tl={key:1},Ul={key:1},Nl={key:0},Ll={key:1},Ml={key:0},Sl={key:1},Ol={key:1},Rl=r("\u5220\u9664"),Il=r("\u6DFB\u52A0\u5B50\u76EE\u5F55"),$l=r("\u4FEE\u6539"),Pl=r("\u5220\u9664"),jl={style:{height:"400px","overflow-y":"auto",padding:"10px"}},zl={class:"select_box"},Xl=r("\u53D6 \u6D88"),Yl=r("\u786E \u5B9A"),ql=ee({name:"Data-governanceMaster-dataIndex"}),ut=ee({...ql,setup(Jl){Me(()=>{I()});const U=m(),Y=m(),q=m([]),R=m(""),le=m(!1),te=m(!1),c=m(!1),N=m(),n=Q({id:"",tableName:"",tableCn:"",description:""}),ae=m({tableName:[{required:!0,message:"\u5FC5\u586B\u9879\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],tableCn:[{required:!0,message:"\u5FC5\u586B\u9879\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),I=()=>{Ye().then(l=>{q.value=l.data})};Se(R,l=>{Y.value.filter(l)});const ue=(l,a)=>l?a.label.includes(l)||a.label.includes(l.toUpperCase())||a.label.includes(l.toLowerCase()):!0,oe=()=>{U.value.init(null,0,"")},ne=()=>{let l=C.optionData;U.value.init(null,l.id,l.path),x()},se=()=>{let l=C.optionData;U.value.init(l.id,l.parentId,l.parentPath),x()},de=()=>{let l=C.optionData;x(),O.confirm("\u786E\u8BA4\u5220\u9664\u5417?","\u63D0\u793A",{confirmButtonText:"\u662F",cancelButtonText:"\u5426",type:"warning"}).then(()=>{qe(l.id).then(a=>{B.success("\u5220\u9664\u6210\u529F\uFF01"),I()})})},A=m(!1),L=m({}),ie=(l,a,p,i)=>{x(),console.log(a.data),a.data.type!=0?(A.value=!0,L.value=a.data,n.id="",N.value.resetFields(),g.value=[],Ge(a.data.id).then(k=>{k.data?(Object.assign(n,k.data),g.value=k.data.columns,c.value=!0):c.value=!1})):(A.value=!1,L.value=a.data,n.id="",N.value.resetFields(),g.value=[])},re={name:"",comment:"",fieldType:"2",fieldLength:"",sacle:"",nullable:1,pk:0},g=m([]),M=m(!1),b=m([]),w=m([]),ce=m({value:"name",children:"children",label:"name"}),J=m([]),$=m([]),pe=l=>{l.fieldType=="dateTime"&&(l.fieldLength=null,l.sacle=null)},_e=l=>{l.pk=="1"&&(l.nullable=0)},fe=()=>{g.value.push(JSON.parse(JSON.stringify(re)))},me=l=>{g.value.splice(l.$index,1)},he=()=>{M.value=!0,el().then(l=>{J.value=l.data[0].children})},ve=()=>{if(w.value){const l=w.value[w.value.length-1];Je(l).then(a=>{$.value=a.data})}},ye=l=>{b.value.splice(l,1)},ge=l=>{for(var a in l)if(b.value.length==0)b.value.push(l[a]);else{var p=!1;for(var i in b.value)if(l[a].name==b.value[i].name){b.value[i]=l[a],p=!0;break}p||b.value.push(l[a])}},P=()=>{w.value=[],b.value=[],$.value=[],M.value=!1},be=()=>{if(b.value.length==0){B.warning("\u8BF7\u9009\u62E9\u9700\u8981\u63D0\u53D6\u7684\u5B57\u6BB5");return}for(var l in b.value)if(g.value.length==0)g.value.push(b.value[l]);else{var a=!1;for(var p in g.value)if(b.value[l].name==g.value[p].name){g.value[p]=b.value[l],a=!0;break}a||g.value.push(b.value[l])}B.success("\u63D0\u53D6\u5B8C\u6BD5\uFF0C\u5DF2\u81EA\u52A8\u8FC7\u6EE4\u66FF\u6362\u91CD\u590D\u5B57\u6BB5"),P()},Ce=()=>{c.value=!1},De=()=>{A.value=!1},Be=()=>{O.confirm("\u786E\u5B9A\u5220\u9664\u5417?","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{Ke(n.id).then(l=>{B.success("\u5220\u9664\u6210\u529F"),A.value=!1})}).catch(()=>{})},ke=()=>{N.value.validate(l=>{if(!l)return!1;var a={};if(a.id=n.id,a.catalogId=L.value.id,a.tableName=n.tableName,a.tableCn=n.tableCn,a.description=n.description,a.columns=g.value,a.columns.length==0){B.warning("\u5B57\u6BB5\u5217\u8868\u4E0D\u53EF\u4E3A\u7A7A");return}var p=[];console.log(a.columns);for(var i in a.columns){var k=a.columns[i].name;if(p.indexOf(k)!=-1){B.warning("\u5B57\u6BB5\u540D\u79F0\u3010"+k+"\u3011\u4E0D\u53EF\u91CD\u590D\uFF0C\u8BF7\u68C0\u67E5");return}else p.push(k)}a.id?He(a).then(F=>{B.success({message:"\u4FDD\u5B58\u6210\u529F",duration:500,onClose:()=>{Object.assign(n,F.data),g.value=F.data.columns,c.value=!0}})}):Qe(a).then(F=>{B.success({message:"\u4FDD\u5B58\u6210\u529F",duration:500,onClose:()=>{Object.assign(n,F.data),g.value=F.data.columns,c.value=!0}})})})},Ee=()=>{O.confirm("\u786E\u5B9A\u53D1\u5E03\u5417\uFF0C\u53D1\u5E03\u540E\u5C06\u540C\u6B65\u751F\u6210\u7269\u7406\u8868?","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{We(n.id).then(l=>{B.success("\u53D1\u5E03\u6210\u529F"),Object.assign(n,l.data)})}).catch(()=>{})},Fe=()=>{O.confirm("\u786E\u5B9A\u53D6\u6D88\u53D1\u5E03\u5417\uFF0C\u53D6\u6D88\u540E\u5C06\u540C\u6B65\u5220\u9664\u7269\u7406\u8868\uFF01","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{Ze(n.id).then(l=>{B.success("\u53D6\u6D88\u53D1\u5E03\u6210\u529F"),Object.assign(n,l.data)})}).catch(()=>{})},C=Q({optionCardShow:!1,optionCardX:0,optionCardY:0,optionData:{},node:"",tree:""}),we=(l,a,p,i)=>{C.optionCardShow=!1,C.optionCardX=l.x,C.optionCardY=l.y,C.optionData=a,C.node=p,C.tree=i,C.optionCardShow=!0},x=l=>{var a=document.getElementById("option-button-group");a&&(C.optionCardShow=!1)};return(l,a)=>{const p=h("el-input"),i=h("el-button"),k=h("el-tree"),F=h("el-scrollbar"),E=h("el-col"),T=h("el-form-item"),j=h("el-row"),Ve=h("el-form"),v=h("el-table-column"),Ae=h("fast-select"),G=h("el-checkbox"),K=h("el-table"),xe=h("el-empty"),Te=h("el-tag"),Ue=h("el-cascader"),Ne=h("el-dialog"),Le=h("el-card"),H=Oe("loading");return o(),_(Le,{"body-style":"height: calc(100vh - 170px )",onClick:a[6]||(a[6]=e=>x())},{default:t(()=>[s("div",null,[u(ze,{class:"fp-content","left-title":"\u4E3B\u6570\u636E\u76EE\u5F55","right-title":"\u4E3B\u6570\u636E\u6A21\u578B"},{left:t(()=>[s("div",null,[u(F,{style:{height:"calc(100vh - 220px )"}},{default:t(()=>[s("div",tl,[s("div",null,[u(p,{modelValue:R.value,"onUpdate:modelValue":a[0]||(a[0]=e=>R.value=e),placeholder:"search"},null,8,["modelValue"]),al,ul]),s("div",null,[u(i,{type:"primary",onClick:oe},{default:t(()=>[ol]),_:1}),nl,sl]),u(k,{ref_key:"treeRef",ref:Y,data:q.value,onNodeContextmenu:we,onNodeClick:ie,"default-expand-all":"","node-key":"id","filter-node-method":ue},{default:t(({node:e,data:d})=>[s("div",dl,[s("span",null,[d.type==0?(o(),y("img",il)):D("",!0),d.type==1?(o(),y("img",rl)):D("",!0),s("span",cl,f(d.name),1)])])]),_:1},8,["data"])])]),_:1})])]),right:t(()=>[S((o(),y("div",pl,[s("div",_l,[c.value?D("",!0):(o(),_(i,{key:0,type:"primary",onClick:ke},{default:t(()=>[fl]),_:1})),c.value?(o(),y(W,{key:1},[n.status?D("",!0):(o(),_(i,{key:0,type:"primary",onClick:Ce},{default:t(()=>[ml]),_:1})),n.status?D("",!0):(o(),_(i,{key:1,type:"danger",onClick:Be},{default:t(()=>[hl]),_:1})),n.status?(o(),_(i,{key:3,type:"primary",onClick:Fe},{default:t(()=>[yl]),_:1})):(o(),_(i,{key:2,type:"primary",onClick:Ee},{default:t(()=>[vl]),_:1}))],64)):D("",!0),u(i,{type:"primary",onClick:De},{default:t(()=>[gl]),_:1})]),s("div",bl,[s("div",Cl,[Dl,u(Ve,{model:n,"label-width":"100px",rules:ae.value,ref_key:"tableInfoRef",ref:N},{default:t(()=>[u(j,null,{default:t(()=>[u(E,{span:2}),u(E,{span:7},{default:t(()=>[u(T,{label:"\u8868\u540D",prop:"tableName"},{default:t(()=>[c.value?(o(),y("span",Bl,f(n.tableName),1)):(o(),_(p,{key:0,modelValue:n.tableName,"onUpdate:modelValue":a[1]||(a[1]=e=>n.tableName=e),placeholder:"\u8868\u540D"},null,8,["modelValue"]))]),_:1})]),_:1}),u(E,{span:7},{default:t(()=>[u(T,{label:"\u4E2D\u6587\u540D\u79F0",prop:"tableCn"},{default:t(()=>[c.value?(o(),y("span",kl,f(n.tableCn),1)):(o(),_(p,{key:0,modelValue:n.tableCn,"onUpdate:modelValue":a[2]||(a[2]=e=>n.tableCn=e),placeholder:"\u4E2D\u6587\u540D\u79F0"},null,8,["modelValue"]))]),_:1})]),_:1})]),_:1}),n.status&&c.value?(o(),_(j,{key:0},{default:t(()=>[u(E,{span:2}),u(E,{span:7},{default:t(()=>[u(T,{label:"\u53D1\u5E03\u4EBA",prop:"releaseUserId"},{default:t(()=>[s("span",null,f(V(Re)(V(X).appStore.sysUserList,n.releaseUserId)),1)]),_:1})]),_:1}),u(E,{span:7},{default:t(()=>[u(T,{label:"\u53D1\u5E03\u65F6\u95F4",prop:"releaseTime"},{default:t(()=>[s("span",null,f(n.releaseTime),1)]),_:1})]),_:1})]),_:1})):D("",!0),u(j,null,{default:t(()=>[u(E,{span:2}),u(E,{span:7},{default:t(()=>[u(T,{label:"\u5907\u6CE8",prop:"description"},{default:t(()=>[c.value?(o(),y("span",El,f(n.description),1)):(o(),_(p,{key:0,type:"textarea",rows:3,modelValue:n.description,"onUpdate:modelValue":a[3]||(a[3]=e=>n.description=e),placeholder:"\u5907\u6CE8"},null,8,["modelValue"]))]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),s("div",Fl,[wl,s("div",Vl,[c.value?D("",!0):(o(),_(i,{key:0,type:"text",onClick:fe},{default:t(()=>[Al]),_:1})),c.value?D("",!0):(o(),_(i,{key:1,style:{"margin-left":"10px"},type:"text",onClick:he},{default:t(()=>[xl]),_:1}))]),u(K,{data:g.value,style:{width:"'100%'"},height:c.value?"calc(100vh - 580px )":"calc(100vh - 605px )",size:"small"},{default:t(()=>[u(v,{align:"center","show-overflow-tooltip":"",props:"name",label:"\u5B57\u6BB5\u540D\u79F0",width:"200"},{default:t(e=>[c.value?(o(),y("span",Tl,f(e.row.name),1)):(o(),_(p,{key:0,modelValue:e.row.name,"onUpdate:modelValue":d=>e.row.name=d,placeholder:"\u5B57\u6BB5\u540D\u79F0"},null,8,["modelValue","onUpdate:modelValue"]))]),_:1}),u(v,{align:"center",label:"\u6570\u636E\u7C7B\u578B",width:"200"},{default:t(e=>[c.value?(o(),y("span",Ul,f(V(Z)(V(X).appStore.dictList,"field_type",e.row.fieldType)),1)):(o(),_(Ae,{key:0,onChange:d=>pe(e.row),modelValue:e.row.fieldType,"onUpdate:modelValue":d=>e.row.fieldType=d,"dict-type":"field_type",placeholder:"\u8BF7\u9009\u62E9"},null,8,["onChange","modelValue","onUpdate:modelValue"]))]),_:1}),u(v,{align:"center",label:"\u957F\u5EA6",width:"160"},{default:t(e=>[c.value?(o(),y("span",Ll,f(e.row.fieldLength),1)):(o(),y("div",Nl,[e.row.fieldType==3||e.row.fieldType==7||e.row.fieldType==8||e.row.fieldType==9||e.row.fieldType==10||e.row.fieldType==11?(o(),_(p,{key:0,disabled:""})):(o(),_(p,{key:1,modelValue:e.row.fieldLength,"onUpdate:modelValue":d=>e.row.fieldLength=d},null,8,["modelValue","onUpdate:modelValue"]))]))]),_:1}),u(v,{align:"center",label:"\u5C0F\u6570\u4F4D\u6570",width:"160"},{default:t(e=>[c.value?(o(),y("span",Sl,f(e.row.fieldType==1||e.row.fieldType==6?e.row.sacle:""),1)):(o(),y("div",Ml,[e.row.fieldType==1||e.row.fieldType==6?(o(),_(p,{key:0,modelValue:e.row.sacle,"onUpdate:modelValue":d=>e.row.sacle=d},null,8,["modelValue","onUpdate:modelValue"])):(o(),_(p,{key:1,disabled:""}))]))]),_:1}),u(v,{align:"center",label:"\u53EF\u7A7A",width:"80"},{default:t(e=>[u(G,{modelValue:e.row.nullable,"onUpdate:modelValue":d=>e.row.nullable=d,disabled:c.value,"true-label":1,"false-label":0},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:1}),u(v,{align:"center",label:"\u4E3B\u952E",width:"80"},{default:t(e=>[u(G,{modelValue:e.row.pk,"onUpdate:modelValue":d=>e.row.pk=d,"true-label":1,"false-label":0,disabled:c.value,onChange:d=>_e(e.row)},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"])]),_:1}),u(v,{align:"center",label:"\u6CE8\u91CA"},{default:t(e=>[c.value?(o(),y("span",Ol,f(e.row.comment),1)):(o(),_(p,{key:0,modelValue:e.row.comment,"onUpdate:modelValue":d=>e.row.comment=d,placeholder:"\u6CE8\u91CA"},null,8,["modelValue","onUpdate:modelValue"]))]),_:1}),c.value?D("",!0):(o(),_(v,{key:0,align:"center",label:"\u64CD\u4F5C",width:"100"},{default:t(e=>[u(i,{type:"text",onClick:d=>me(e)},{default:t(()=>[Rl]),_:2},1032,["onClick"])]),_:1}))]),_:1},8,["data","height"])])])])),[[z,A.value],[H,le.value]]),L.value.type!=1?(o(),_(xe,{key:0,description:"\u8BF7\u9009\u62E9\u5DE6\u4FA7\u76EE\u5F55 \u83B7\u53D6\u8BE6\u60C5"})):D("",!0)]),default:t(()=>[ll]),_:1})]),S(s("div",{style:Ie({"z-index":9999,position:"fixed",left:C.optionCardX+"px",top:C.optionCardY+"px",width:"100px",background:"white","box-shadow":"0 2px 4px rgba(0, 0, 0, .12), 0 0 6px rgba(0, 0, 0, .04)"}),id:"option-button-group"},[S(u(i,{onClick:ne,class:"option-card-button"},{default:t(()=>[Il]),_:1},512),[[z,C.optionData.type==0]]),u(i,{onClick:se,class:"option-card-button"},{default:t(()=>[$l]),_:1}),u(i,{onClick:de,class:"option-card-button"},{default:t(()=>[Pl]),_:1})],4),[[z,C.optionCardShow]]),u(Xe,{ref_key:"addOrUpdateRef",ref:U,onRefreshDataList:I},null,512),u(Ne,{"close-on-click-modal":!1,title:"\u4ECE\u5DF2\u6709\u8868\u62FE\u53D6\u5B57\u6BB5",modelValue:M.value,"onUpdate:modelValue":a[5]||(a[5]=e=>M.value=e),width:"1000px","append-to-body":"",class:"sheet_field_column",onClose:P},{footer:t(()=>[s("div",null,[u(i,{onClick:P},{default:t(()=>[Xl]),_:1}),u(i,{type:"primary",onClick:be},{default:t(()=>[Yl]),_:1})])]),default:t(()=>[S((o(),y("div",jl,[s("div",zl,[(o(!0),y(W,null,$e(b.value,(e,d)=>(o(),_(Te,{key:d,closable:"",onClose:Gl=>ye(d)},{default:t(()=>[r(f(e.name),1)]),_:2},1032,["onClose"]))),128))]),s("div",null,[u(Ue,{modelValue:w.value,"onUpdate:modelValue":a[4]||(a[4]=e=>w.value=e),style:{width:"100%"},clearable:"","show-all-levels":!0,props:{...ce.value},options:J.value,onChange:ve},{default:t(({node:e,data:d})=>[s("span",null,f(d.name),1)]),_:1},8,["modelValue","props","options"])]),u(K,{data:$.value,style:{width:"100%","margin-top":"10px"},size:"small",height:"200px",onSelectionChange:ge},{default:t(()=>[u(v,{type:"selection","header-align":"center",align:"center",width:"50"}),u(v,{align:"center",props:"name",label:"\u5B57\u6BB5\u540D\u79F0"},{default:t(e=>[r(f(e.row.name),1)]),_:1}),u(v,{align:"center",props:"fieldType",label:"\u7C7B\u578B"},{default:t(e=>[r(f(V(Z)(V(X).appStore.dictList,"field_type",e.row.fieldType)),1)]),_:1}),u(v,{align:"center",props:"fieldLength",label:"\u957F\u5EA6"},{default:t(e=>[r(f(e.row.fieldLength),1)]),_:1}),u(v,{align:"center",props:"sacle",label:"\u5C0F\u6570\u4F4D\u6570"},{default:t(e=>[r(f(e.row.fieldType==1||e.row.fieldType==6?e.row.sacle:""),1)]),_:1}),u(v,{align:"center",props:"nullable",label:"\u53EF\u7A7A"},{default:t(e=>[r(f(e.row.nullable?"\u662F":"\u5426"),1)]),_:1}),u(v,{align:"center",props:"pk",label:"\u4E3B\u952E"},{default:t(e=>[r(f(e.row.pk?"\u662F":"\u5426"),1)]),_:1}),u(v,{align:"center","show-overflow-tooltip":"",props:"comment",label:"\u6CE8\u91CA"},{default:t(e=>[r(f(e.row.comment),1)]),_:1})]),_:1},8,["data"])])),[[H,te.value]])]),_:1},8,["modelValue"])]),_:1})}}});export{ut as default};
